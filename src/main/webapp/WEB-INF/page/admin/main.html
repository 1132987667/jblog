<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>日志列表</title>
    <#include "/admin/include/bootstrap.ftl">
        <script src="${webroot}/www/admin/js/main.js"></script>
</head>
<body>
<!-- 左边导航 -->
<div class="navigate-panel">
    <div class="row nav-profile">
        <img src="${BLOG_CURRENT_USER.userProfileImg}<#if AdminWebSite.user.userProfileImg?index_of(" res.51so.info")!=-1>_profile.100X100</#if>
        " align="bottom" width="100" height="100" class="center-block"/>
        <center class="dashboard_title">${AdminWebSite.websiteTitle}</center>
    </div>
    <div class="nav-folder" id="blog_main_li" onclick="window.location='${webroot}/admin/main.do'">
        <a style="color:#aeb2b7;"><span class="glyphicon glyphicon-home"></span>&nbsp;后台首页</a>
    </div>
    <div class="nav-folder" id="write_article_li" onclick="adminMain.openPage('${webroot}/admin/edit_article.do')">
        <a style="color:#aeb2b7;"><span class="glyphicon glyphicon-pencil"></span>&nbsp;写日志</a>
    </div>
    <!---->
    <div class="panel-group" id="accordion">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                        <span class="glyphicon glyphicon-align-justify"></span>&nbsp;日志管理
                    </a>
                </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse">
                <div class="panel-body">
                    <a id="category_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/category_list.do')"><span
                            class="glyphicon glyphicon-th-large"></span>&nbsp;分类管理</a>
                    <a id="article_li" class="nav-folder-item"  href="javascript:adminMain.openPage('${webroot}/admin/article_list.do')"><span
                            class="glyphicon glyphicon-file"></span>&nbsp;文章管理</a>
                    <a id="blog_comment_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/article_comments.do')"><span
                            class="glyphicon glyphicon-comment"></span>&nbsp;评论管理</a>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                        <span class="glyphicon glyphicon-bookmark"></span>&nbsp;书签管理
                    </a>
                </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse">
                <div class="panel-body">
                    <a id="bookmark_folder_li" class="nav-folder-item"
                       href="javascript:adminMain.openPage('${webroot}/admin/bookmark_folder_list.do')"><span class="glyphicon glyphicon-book"></span>&nbsp;书签包管理</a>
                    <a id="bookmark_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/bookmark_list.do')"><span
                            class="glyphicon glyphicon-bookmark"></span>&nbsp;书签管理</a>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                        <span class="glyphicon glyphicon-cog"></span>&nbsp;设置
                    </a>
                </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse">
                <div class="panel-body">
                    <a id="bolg_profile_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/profile.do')"><span
                            class="glyphicon glyphicon-user"></span>&nbsp;个人信息</a>
                    <a class="nav-folder-item" data-toggle="modal" data-target="#myModal" href="#"><span
                            class="glyphicon glyphicon-lock"></span>&nbsp;修改密码</a>
                    <a id="bolg_info_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/website_info.do')"><span
                            class="glyphicon glyphicon-info-sign"></span>&nbsp;博客信息</a>
                    <a id="blog_res_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/blogres_list.do')"><span
                            class="glyphicon glyphicon-folder-open"></span>&nbsp;资源管理</a>
                    <a id="blog_upload_page" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/upload_page.do')"><span
                            class="glyphicon glyphicon-upload"></span>&nbsp;文件上传</a>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
                        <span class="glyphicon glyphicon-search"></span>&nbsp;报表
                    </a>
                </h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse">
                <div class="panel-body">
                    <a id="blog_access_log_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/report/accessLog.do')"><span
                            class="glyphicon glyphicon-time"></span>&nbsp;访客记录</a>
                    <a id="blog_report_li" class="nav-folder-item" href="javascript:adminMain.openPage('${webroot}/admin/report/page.do')"><span
                            class="glyphicon glyphicon-search"></span>&nbsp;网站报表</a>
                </div>
            </div>
        </div>

    </div>
    <div class="nav-folder"
         onclick="<#if AdminWebSite??>window.open('http://${AdminWebSite.websiteName}.${host}');<#else>javascript:alert('你还未创建博客!');</#if>">
        <span class="glyphicon glyphicon-globe"></span>&nbsp;我的博客
    </div>
    <div class="nav-folder" onclick="window.open('http://${host}');">
        <span class="glyphicon glyphicon-globe"></span>&nbsp;平台首页
    </div>
    <div class="nav-folder" style="color:red;" onclick="blog.userLogout();">
        <span class="glyphicon glyphicon-remove"></span>&nbsp;退出
    </div>

    <!---->

</div>
<div class="page-content" id="page-content">
    <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" id="pageFrame" src=""></iframe>
    </div>
</div>
<!--start Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">修改密码</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" method="post" action="admin/modify_psw.do" id="editpswform">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">旧密码</label>

                        <div class="col-sm-8">
                            <input type="password" class="form-control" name="oldpsw" id="oldpsw" placeholder="请输入旧密码"
                                   maxlength="20">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">新密码</label>

                        <div class="col-sm-8">
                            <input type="password" class="form-control" name="newpsw" id="newpsw" placeholder="请输入新密码"
                                   maxlength="20">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">确认密码</label>

                        <div class="col-sm-8">
                            <input type="password" class="form-control" name="cnewpsw" placeholder="请输入新密码"
                                   maxlength="20">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" onclick="mofifypsw();"> 提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div><!-- end Modal -->

<script type="text/javascript">
    function builderindex() {
        bootbox.confirm('是否重新生成索引？', function (result) {
            if (result) {
                $.ajax({
                    type: "post",
                    url: "${blogprefix}/admin/build_index.do",
                    success: function (msg) {
                        if (msg == "success") {
                            blog.nofify("操作成功!", "success");
                        } else {
                            bootbox.alert(msg);
                        }
                    }
                });
            }

        });

    }
    $('#editpswform').bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            oldpsw: {
                message: '密码不合规则!',
                validators: {
                    notEmpty: {
                        message: '请输入旧密码！'
                    }
                }
            },
            newpsw: {
                validators: {
                    notEmpty: {
                        message: '请输入新密码！'
                    }, stringLength: {
                        min: 6,
                        max: 30,
                        message: '密码长度为6至20'
                    }
                }
            },
            cnewpsw: {
                validators: {
                    notEmpty: {
                        message: '请再一次输入新密码'
                    }, identical: {
                        field: 'newpsw',
                        message: '两次输入新密码不一致!'
                    }
                }
            }
        }
    });


    function mofifypsw() {
        var result = $('#editpswform').data('bootstrapValidator').isValid();
        if (result) {
            $.ajax({
                type: "post",
                url: "${webroot}/admin/modify_psw.do",
                data: {newpsw: $('#newpsw').val(), oldpsw: $('#oldpsw').val()},
                success: function (msg) {
                    if (msg == "success") {
                        $('#myModal').modal('hide');
                        blog.nofify("密码修改成功!", "success");
                        $('#editpswform')[0].reset();
                        $('#editpswform').data('bootstrapValidator').resetForm();

                    } else {
                        var msg = "<b style='color:red;'>" + msg + "</b>";
                        bootbox.alert({message: msg, size: 'small'});
                    }
                }
            });
        } else {
            bootbox.alert('请按要求填写表单信息!');
        }
    }
</script>
</body>
</html>